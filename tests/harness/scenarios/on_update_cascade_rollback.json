{
  "name": "on_update_cascade_rollback",
  "description": "Crash during parent UPDATE with ON UPDATE CASCADE must not commit partial parent/child updates",
  "db_path": "$TMPDIR/decentdb_on_update_cascade.ddb",
  "setup_sql": "CREATE TABLE parent (id INT PRIMARY KEY, code TEXT UNIQUE); CREATE UNIQUE INDEX parent_id_uq ON parent (id); CREATE TABLE child (id INT PRIMARY KEY, parent_code TEXT REFERENCES parent(code) ON UPDATE CASCADE); INSERT INTO parent VALUES (1, 'a'); INSERT INTO child VALUES (10, 'a')",
  "sql": "UPDATE parent SET code = 'b' WHERE id = 1",
  "failpoint": {
    "label": "wal_write_frame",
    "kind": "error"
  },
  "verify": {
    "expect_crash": true,
    "post_crash_sql": "SELECT code FROM parent UNION ALL SELECT parent_code FROM child",
    "expect_rows": [
      "a",
      "a"
    ]
  }
}
